# 校园卡系统模块技术与部署分析

## 项目概述

校园卡系统是一个基于微服务架构的综合管理平台，包含多个后端API服务和前端Web应用。系统采用Spring Boot作为后端框架，Vue 3作为前端框架，MySQL作为主要数据存储，Redis作为缓存和队列处理。

## 模块架构图

```
校园卡系统
├── 后端服务
│   ├── campus-card-common (公共模块)
│   ├── campus-card-admin-api (管理后台API)
│   ├── campus-card-wechat-api (微信API)
│   └── campus-card-gateway-api (网关API)
└── 前端应用
    ├── h (管理后台Web)
    └── campus-card-wechat-web (微信Web)
```

## 后端模块分析

### 1. campus-card-common (公共模块)

**技术栈:**
- Java 17
- Maven 3.x
- Lombok 1.18.30

**功能描述:**
- 提供公共工具类、实体类和常量定义
- 被其他后端模块依赖引用

**部署配置:**
- 打包为JAR文件，不独立部署
- 作为依赖库被其他模块引用

**构建命令:**
```bash
mvn clean install -pl campus-card-common
```

---

### 2. campus-card-admin-api (管理后台API)

**技术栈:**
- Spring Boot 2.7.18
- Java 8
- Spring Data JPA
- MySQL 8.0.33
- Redis (用于队列处理)
- Lombok
- Maven 3.x

**功能描述:**
- 提供管理后台的API接口
- 处理用户管理、权限管理、学生管理等核心业务
- 包含人脸识别配置和考勤管理功能

**端口配置:**
- 开发环境: 8080

**数据库配置:**
- 主数据库: MySQL
- 默认连接: `jdbc:mysql://localhost:3306/campus_card`
- 用户名: root
- 密码: mgq@2024
- JPA配置: `ddl-auto=none` (不自动建表)
- 数据库初始化: 通过SQL脚本执行

**Redis配置:**
- 主机: localhost (可通过REDIS_HOST环境变量覆盖)
- 端口: 6379 (可通过REDIS_PORT环境变量覆盖)
- 密码: 无 (可通过REDIS_PASSWORD环境变量覆盖)

**部署配置:**
- 打包为可执行JAR
- 包含完整的Spring Boot应用
- 支持通过环境变量配置数据库和Redis连接

**构建与部署命令:**
```bash
# 构建
mvn clean package -pl campus-card-admin-api -DskipTests

# 运行
java -jar campus-card-admin-api/target/campus-card-admin-api-0.0.1-SNAPSHOT.jar

# 或使用环境变量配置
MYSQL_HOST=localhost MYSQL_PORT=3306 MYSQL_DB=campus_card MYSQL_USER=root MYSQL_PASSWORD=mgq@2024 java -jar campus-card-admin-api/target/campus-card-admin-api-0.0.1-SNAPSHOT.jar
```

---

### 3. campus-card-wechat-api (微信API)

**技术栈:**
- Spring Boot 2.7.18
- Java 8
- Spring Data JPA
- MySQL 8.0.33
- Lombok
- Maven 3.x

**功能描述:**
- 提供微信小程序端的API接口
- 处理学生信息查询、考勤记录、消费记录等功能
- 支持请假申请和人脸采集等业务

**端口配置:**
- 开发环境: 8082

**数据库配置:**
- 主数据库: MySQL
- 默认连接: `jdbc:mysql://localhost:3306/campus_card`
- 用户名: root
- 密码: mgq@2024
- JPA配置: `ddl-auto=update` (自动更新表结构)

**部署配置:**
- 打包为可执行JAR
- 包含完整的Spring Boot应用
- 支持通过环境变量配置数据库连接

**构建与部署命令:**
```bash
# 构建
mvn clean package -pl campus-card-wechat-api -DskipTests

# 运行
java -jar campus-card-wechat-api/target/campus-card-wechat-api-0.0.1-SNAPSHOT.jar

# 或使用环境变量配置
DB_URL=jdbc:mysql://localhost:3306/campus_card DB_USERNAME=root DB_PASSWORD=mgq@2024 java -jar campus-card-wechat-api/target/campus-card-wechat-api-0.0.1-SNAPSHOT.jar
```

---

### 4. campus-card-gateway-api (网关API)

**技术栈:**
- Spring Boot 2.7.18
- Java 8
- SpringDoc OpenAPI 1.7.0 (Swagger)
- JWT (jjwt 0.11.5)
- Lombok
- Maven 3.x

**功能描述:**
- 提供外部系统访问的网关接口
- 实现JWT认证和授权
- 提供API文档(Swagger)
- 包含卡务、人脸、设备对接等接口

**端口配置:**
- 开发环境: 8083

**安全配置:**
- JWT认证: HS256算法
- 令牌有效期: 60分钟
- 刷新令牌有效期: 10080分钟(7天)
- 速率限制: 60次/分钟

**部署配置:**
- 打包为可执行JAR
- 包含完整的Spring Boot应用
- 支持通过配置文件调整安全策略

**构建与部署命令:**
```bash
# 构建
mvn clean package -pl campus-card-gateway-api -DskipTests

# 运行
java -jar campus-card-gateway-api/target/campus-card-gateway-api-0.0.1-SNAPSHOT.jar
```

**API文档:**
- Swagger UI: `http://localhost:8083/swagger-ui.html`
- OpenAPI JSON: `http://localhost:8083/v3/api-docs`

---

## 前端模块分析

### 1. h (管理后台Web)

**技术栈:**
- Vue 3.5.22
- TypeScript 5.9.3
- Vite 7.1.7
- Ant Design Vue 4.2.6
- Vue Router 4.6.3
- Pinia 3.0.3
- Axios 1.12.2
- ECharts 6.0.0
- VXE Table 4.17.0

**功能描述:**
- 管理后台前端界面
- 提供用户管理、学生管理、系统配置等功能
- 包含数据可视化和报表功能

**开发配置:**
- API基础地址: `http://localhost:8080`
- 开发服务器端口: 默认5173 (Vite默认)

**部署配置:**
- 构建为静态文件
- 可部署到任何Web服务器(Nginx、Apache等)

**构建与部署命令:**
```bash
# 安装依赖
npm install

# 开发环境运行
npm run dev

# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

---

### 2. campus-card-wechat-web (微信Web)

**技术栈:**
- Vue 3.5.22
- TypeScript 5.9.3
- Vite 7.1.7
- Vant 4.9.21 (移动端UI组件库)
- Vue Router 4.6.3
- Pinia 3.0.3
- Axios 1.12.2

**功能描述:**
- 微信小程序/H5前端界面
- 提供学生信息查询、考勤记录、消费记录等功能
- 支持请假申请和人脸采集等业务

**开发配置:**
- API基础地址: `http://localhost:8082`
- 开发服务器端口: 默认5173 (Vite默认)

**部署配置:**
- 构建为静态文件
- 可部署到任何Web服务器(Nginx、Apache等)
- 适合部署到微信小程序或H5环境

**构建与部署命令:**
```bash
# 安装依赖
npm install

# 开发环境运行
npm run dev

# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

---

## 系统集成与部署建议

### 开发环境部署

1. **数据库准备**
   ```bash
   # 安装MySQL 8.0
   # 创建数据库
   CREATE DATABASE campus_card;
   ```

2. **Redis准备**
   ```bash
   # 安装Redis
   # 启动Redis服务
   redis-server
   ```

3. **后端服务启动**
   ```bash
   # 启动管理API
   java -jar campus-card-admin-api/target/campus-card-admin-api-0.0.1-SNAPSHOT.jar
   
   # 启动微信API
   java -jar campus-card-wechat-api/target/campus-card-wechat-api-0.0.1-SNAPSHOT.jar
   
   # 启动网关API
   java -jar campus-card-gateway-api/target/campus-card-gateway-api-0.0.1-SNAPSHOT.jar
   ```

4. **前端应用启动**
   ```bash
   # 启动管理后台
   cd h && npm run dev
   
   # 启动微信Web
   cd campus-card-wechat-web && npm run dev
   ```

### 生产环境部署建议

1. **容器化部署**
   - 使用Docker容器化各个服务
   - 使用Docker Compose编排服务
   - 使用Kubernetes进行集群管理

2. **负载均衡**
   - 使用Nginx作为反向代理和负载均衡
   - 配置SSL证书实现HTTPS

3. **数据库优化**
   - 配置MySQL主从复制
   - 设置Redis集群
   - 配置数据库连接池

4. **监控与日志**
   - 集成Prometheus和Grafana进行监控
   - 使用ELK Stack收集和分析日志
   - 配置告警机制

5. **CI/CD流程**
   - 使用Jenkins或GitLab CI实现自动化构建和部署
   - 配置自动化测试
   - 实现蓝绿部署或滚动更新

---

## 技术选型分析

### 后端技术选型

1. **Spring Boot 2.7.18**
   - 优点: 成熟稳定、生态丰富、开发效率高
   - 适用场景: 企业级应用、微服务架构

2. **Spring Data JPA**
   - 优点: 简化数据访问、支持多种数据库
   - 适用场景: CRUD操作频繁的业务

3. **MySQL 8.0**
   - 优点: 性能优秀、功能丰富、社区活跃
   - 适用场景: 关系型数据存储

4. **Redis**
   - 优点: 高性能、数据结构丰富
   - 适用场景: 缓存、队列、会话存储

### 前端技术选型

1. **Vue 3**
   - 优点: 轻量高效、学习曲线平缓、生态完善
   - 适用场景: 单页应用、组件化开发

2. **TypeScript**
   - 优点: 类型安全、代码提示、重构友好
   - 适用场景: 大型项目、团队协作

3. **Vite**
   - 优点: 快速开发服务器、优化的构建流程
   - 适用场景: 现代前端开发

4. **Ant Design Vue / Vant**
   - 优点: 企业级/移动端UI组件、设计一致
   - 适用场景: 快速构建界面

---

## 总结

校园卡系统采用前后端分离的微服务架构，后端使用Spring Boot技术栈，前端使用Vue 3技术栈，数据库使用MySQL和Redis。系统设计合理，模块划分清晰，适合中小型校园卡管理场景。

系统具有良好的可扩展性和可维护性，可以根据实际需求进行功能扩展和性能优化。建议在生产环境中采用容器化部署，并配置完善的监控和日志系统。